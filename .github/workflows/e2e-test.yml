on: push

name: E2E Test

defaults:
 run:
  working-directory: ./tests/e2e/

jobs:
  main:
    runs-on: ubuntu-latest

    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: release

      - name: Install R package dependencies
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          extra-packages: local::.

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 16

      - name: init() should create a Rhino directory
        if: always()
        shell: Rscript {0}
        run: rhino::init('RhinoApp')

      - name: test_r()
        if: always()
        run: |
          cd RhinoApp
          ls -al
          Rscript -e 'testthat::test_dir(fs::path("tests", "testthat"))'
